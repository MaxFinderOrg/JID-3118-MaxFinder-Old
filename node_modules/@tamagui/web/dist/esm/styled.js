import { createComponent } from "./createComponent";
import { mergeVariants } from "./helpers/mergeVariants";
import { getReactNativeConfig } from "./setupReactNative";
function styled(ComponentIn, options, staticExtractionOptions) {
  if (process.env.NODE_ENV !== "production") {
    if (!ComponentIn) {
      throw new Error(`No component given to styled()`);
    }
  }
  const parentStaticConfig = ComponentIn["staticConfig"];
  const isPlainStyledComponent = !!parentStaticConfig && !(parentStaticConfig.isReactNative || parentStaticConfig.isHOC);
  const isNonStyledHOC = (parentStaticConfig == null ? void 0 : parentStaticConfig.isHOC) && !(parentStaticConfig == null ? void 0 : parentStaticConfig.isStyledHOC);
  let Component = isNonStyledHOC || isPlainStyledComponent ? ComponentIn : (parentStaticConfig == null ? void 0 : parentStaticConfig.Component) || ComponentIn;
  const reactNativeConfig = getReactNativeConfig(Component);
  const isReactNative = Boolean(
    reactNativeConfig || (staticExtractionOptions == null ? void 0 : staticExtractionOptions.isReactNative) || (parentStaticConfig == null ? void 0 : parentStaticConfig.isReactNative) || getReactNativeConfig(parentStaticConfig == null ? void 0 : parentStaticConfig.Component)
  );
  const staticConfigProps = (() => {
    if (options) {
      let {
        variants,
        name,
        defaultVariants,
        acceptsClassName: acceptsClassNameProp,
        context,
        ...defaultProps
      } = options;
      if (defaultVariants) {
        defaultProps = {
          ...defaultVariants,
          ...defaultProps
        };
      }
      if (parentStaticConfig) {
        const avoid = parentStaticConfig.isHOC && !parentStaticConfig.isStyledHOC;
        if (!avoid) {
          defaultProps = {
            ...parentStaticConfig.defaultProps,
            ...defaultProps
          };
        }
        if (parentStaticConfig.variants) {
          variants = mergeVariants(parentStaticConfig.variants, variants);
        }
      }
      if (parentStaticConfig == null ? void 0 : parentStaticConfig.isHOC) {
        if (name) {
          defaultProps.componentName = name;
        }
      }
      const isText = Boolean(
        (staticExtractionOptions == null ? void 0 : staticExtractionOptions.isText) || (parentStaticConfig == null ? void 0 : parentStaticConfig.isText)
      );
      const acceptsClassName = acceptsClassNameProp ?? (isPlainStyledComponent || isReactNative || (parentStaticConfig == null ? void 0 : parentStaticConfig.isHOC) && (parentStaticConfig == null ? void 0 : parentStaticConfig.acceptsClassName));
      const conf = {
        ...parentStaticConfig,
        ...staticExtractionOptions,
        ...!isPlainStyledComponent && {
          Component
        },
        // this type gets messed up by options?: Partial<GetProps<ParentComponent>> above
        // take away the Partial<> and it's fine
        variants,
        defaultProps,
        defaultVariants,
        componentName: name || (parentStaticConfig == null ? void 0 : parentStaticConfig.componentName),
        isReactNative,
        isText,
        acceptsClassName,
        context,
        ...reactNativeConfig,
        isStyledHOC: Boolean(parentStaticConfig == null ? void 0 : parentStaticConfig.isHOC),
        parentStaticConfig
      };
      if (defaultProps.children || !acceptsClassName || context) {
        conf.neverFlatten = true;
      }
      return conf;
    }
  })();
  const component = createComponent(staticConfigProps || {});
  for (const key in ComponentIn) {
    if (key in component)
      continue;
    component[key] = ComponentIn[key];
  }
  return component;
}
export {
  styled
};
//# sourceMappingURL=styled.js.map
